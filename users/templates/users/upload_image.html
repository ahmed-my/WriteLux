{% load static %}
{% load form_tags %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Upload Image</title>
    <link rel="stylesheet" href="{% static 'css-style/image-upload.css' %}">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
</head>
<body>
  <div class="container mt-5">
    <div class="row justify-content-center">
      <div class="col-md-8">
        <div class="card shadow-sm">
          <div class="card-header bg-primary text-white text-center">
            <h2 class="mb-0">Upload Image</h2>
          </div>
          <div class="card-body">
            <form id="uploadForm" method="post" enctype="multipart/form-data" action="{% url 'users:upload_image' %}" data-redirect-url="{% url 'users:portfolio' %}">
              {% csrf_token %}
              <input type="hidden" id="folder-count-input" name="folder_count" value="{{ folder_count }}">
              <input type="hidden" id="folder_ids" name="folder_ids" value="{% for folder in selected_folders %}{{ folder.id }}{% if not forloop.last %},{% endif %}{% endfor %}">

              <div class="form-group mb-4">
                {{ form.image.label_tag }} 
                {{ form.image|add_class:"form-control" }}
              </div>
              <div class="form-group mb-4">
                {{ form.description.label_tag }} 
                {{ form.description|add_class:"form-control" }}
              </div>

              <!-- Selected Folders Card -->
              <div class="folders-card">
                {% if folder_count > 1 %}
                  <h5>Selected Folders</h5>
                {% else %}
                  <h5>Selected Folder</h5>
                {% endif %}
                {% if selected_folders %}
                    {% for folder in selected_folders %}
                        <label class="custom-checkbox">
                            <input type="checkbox" name="folders" value="{{ folder.id }}" id="folder-{{ folder.id }}" checked disabled>
                            <span class="custom-checkbox-box"></span>
                            <span class="custom-checkbox-label">{{ folder.name }}</span>
                        </label>
                    {% endfor %}
                {% else %}
                    {{ form.folder|add_class:"form-control" }}
                {% endif %}
              </div>

              <div class="text-center">
                <button type="submit" class="btn btn-primary w-50 mb-2">
                  <i class="fas fa-upload"></i> Upload
                </button>
                <br>
                <a href="{% url 'users:portfolio' %}" class="btn btn-secondary w-50">
                  <i class="fas fa-arrow-left"></i> Back to Portfolio
                </a>
              </div>
            </form>
          </div>
        </div>
      </div>
    </div>
  </div>

  {% block extra_scripts %}
    <script src="{% static 'js/portfolio.js' %}"></script>
  {% endblock %}
</body>
</html>
